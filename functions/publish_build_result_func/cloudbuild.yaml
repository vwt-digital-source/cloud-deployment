steps:
- name: 'gcr.io/cloud-builders/gcloud'
  args:
  - 'services'
  - 'enable'
  - 'cloudbuild.googleapis.com'
  - 'pubsub.googleapis.com'
  - 'cloudfunctions.googleapis.com'

- name: 'gcr.io/cloud-builders/gcloud'
  args:
  - 'functions'
  - 'deploy'
  - 'publish_build_result_func'
  - '--runtime=python37'
  - '--entry-point=publish_build_result_func'
  - '--trigger-topic=cloud-builds'
  - '--region=${_DEPLOYMENT_REGION}'
  - '--project=${PROJECT_ID}'
  - '--set-env-vars=PUBLISH_PROJECT_ID=${_PUBLISH_PROJECT_ID},PUBLISH_TOPIC_NAME=${_PUBLISH_TOPIC_NAME}'
